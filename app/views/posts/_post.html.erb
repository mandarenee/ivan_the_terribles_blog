<% cache "post" do %>
  <section class="post">
    <% cache post do %>
    <h2>Post <%= "#{post.id}: #{post.title}" %></h2>
    <div class="post"><%= post.body %></div>
    <% cache "post_nav" do %>
      <div class="post_nav">
        <%= link_to 'Show Comments', post %> |
        <%= link_to 'Edit', edit_post_path(post) %> |
        <%= link_to 'Destroy', post, method: :delete, data: { confirm: 'Are you sure?' } %>
      </div>
    <% end %>

    <% post.comments.each do |comment| %>
      <div class="comment">
        <% cache comment do %>
        <h3>Comment <%= comment.id %>:</h3>
        <p><%= comment.body %></p>
        <div class="reply">
          <% cache comment.replies do %>
            <%= render comment.replies %>
          <% end %>
        </div>
        <% end %>
      </div>
      <% end %>
    <% end %>
  </section>
<% end %>
